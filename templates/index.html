<!DOCTYPE html>
<html>
  <head>
    <title>Google Maps API</title>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRYJk-2BLkeBUA0SPIGZPzAhDqzfdy4D0&callback=initMap"
      async
      defer
    ></script>
    <script>
      let map;
      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 41.8781, lng: -87.6298 },
          zoom: 13,
        });
        let marker = new google.maps.Marker({
          position: { lat: 41.8781, lng: -87.6298 },
          draggable: true,
          map: map,
        });
        google.maps.event.addListener(marker, "dragend", function () {
          let latlng = marker.getPosition();
          let lat = latlng.lat();
          let lng = latlng.lng();
          sendLocation(lat, lng);
        });
      }
      function sendLocation(lat, lng) {
        let xhr = new XMLHttpRequest();
        xhr.open("POST", "/get_location");
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.onload = function () {
          if (xhr.status === 200) {
            window.location.href = "/show_map";
          }
        };
        let data = {
          lat: lat,
          lng: lng,
        };
        xhr.send(JSON.stringify(data));
      }
    </script>
  </head>
  <body>
    <div id="map" style="height: 500px"></div>
  </body>
</html>